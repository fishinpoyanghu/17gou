var validCode=!0,name,province,city,area,street,mobile,addressList,type,zfbAccount,zfbName;$(function(){tableId="#datalist";$($(".c_out_a")[9]).addClass("c_click_newa");addAddress();getAddress();$(window).resize(function(){var b=$("body").height(),a=$(window).width(),d=$(window).height();$(".c_exchange_bg").css({height:b+"px"});$(".c_address_in").css({left:(a-784)/2+"px",top:(d-492)/2+"px"})});$(window).resize();$("#area").change(function(){if(-1!=$("#area").val()){var b;b=""+($("#province option:selected").text()+"  ");b+=$("#city option:selected").text()+"  ";b+=$("#area option:selected").text();$("#addStr").html(b);$("#addStr").show();$("#addStr").parents(".c_form_con").addClass("c_newform_con")}})});function getAddress(){ajaxMemberAddressDetail(bindAddress)}function bindAddress(b){var a=b.list.length;$(".c_address_top").html("\x3cspan\x3e\x3c/span\x3e\u5df2\u4fdd\u5b58"+a+"\u6761\u5730\u5740\uff0c\u8fd8\u80fd\u4fdd\u5b58"+(3-a)+"\u6761\u5730\u5740");a="";addressList=b.list;for(var d=0;d<addressList.length;d++){var c=addressList[d],a=a+'\x3cdiv class\x3d"c_address_detail c_new_address_detail"\x3e';1==c.isdefault?(a+='\x3cp class\x3d"c_p_bg"\x3e\x3c/p\x3e',a+='\x3cdiv class\x3d"c_address_operation"\x3e',a+='\x3cdiv class\x3d"c_address_default"\x3e',a+="\x3ci\x3e\x3c/i\x3e\u9ed8\u8ba4\u5730\u5740",a+="\x3c/div\x3e",a+='\x3cdiv class\x3d"c_address_all_operation"\x3e',a+='\x3ca href\x3d"javascript:editAddress('+d+');" title\x3d"\u7f16\u8f91" class\x3d"c_set_edit"\x3e\x3c/a\x3e'):(a+='\x3cp class\x3d"c_p_bg c_p_bg_other"\x3e\x3c/p\x3e',a+='\x3cdiv class\x3d"c_address_operation"\x3e',a+='\x3cdiv class\x3d"c_address_all_operation"\x3e',a+='\x3ca href\x3d"javascript:setDefault('+c.id+');" title\x3d"\u8bbe\u4e3a\u9ed8\u8ba4\u5730\u5740" class\x3d"c_set_default"\x3e\x3c/a\x3e',a+='\x3ca href\x3d"javascript:editAddress('+d+');" title\x3d"\u7f16\u8f91" class\x3d"c_set_edit"\x3e\x3c/a\x3e',a+='\x3ca href\x3d"javascript:deleteAddress('+c.id+')" title\x3d"\u5220\u9664" class\x3d"c_set_delete"\x3e\x3c/a\x3e');a+="\x3c/div\x3e";a+="\x3c/div\x3e";a+='\x3cdiv class\x3d"c_user_address"\x3e';a+='\x3cp class\x3d"c_user_message"\x3e'+c.consignee+"      "+encryptPhone(c.mobile)+"\x3c/p\x3e";a+='\x3cp title\x3d"'+c.province+"   "+c.city+"  "+c.area+'"\x3e'+c.province+"   "+c.city+"  "+c.area+"\x3c/p\x3e";a+='\x3cp title\x3d"'+c.street+'"\x3e'+c.street+"\x3c/p\x3e";a+="\x3c/div\x3e";a+="\x3cspan\x3e\x3c/span\x3e";a+="\x3c/div\x3e"}3>b.list.length&&(a+='\x3cdiv class\x3d"c_add_address c_new_address_detail"\x3e\x3ca href\x3d"javascript:void(0);" class\x3d"c_add_address_btn"\x3e\x3ci\x3e\x3c/i\x3e\u589e\u52a0\u65b0\u5730\u5740\x3c/a\x3e',a+="\x3c/div\x3e");$("#datalist").html(a);$(".c_veri_code").click(function(){validCode&&checkData()&&ajaxMemberAddressSendMsg(sendMsgCallback)});$(".c_add_address_btn").click(function(){0==addressList.length?$("#isdefaultDiv").hide():$("#isdefaultDiv").show();$(".c_exchange_bg").show();$(".c_address_in").show();type="add";$(".c_save").attr("onclick","saveAddress();");$("#addStr").hide();$("#addStr").parents(".c_form_con").removeClass("c_newform_con")});$(".c_em_close").click(function(){$(".c_exchange_bg").hide();$(".c_address_in").hide();clean()});$(".c_save_other").click(function(){$(".c_exchange_bg").hide();$(".c_address_in").hide();clean()})}function sendMsgCallback(b){validCode=!1;$(".c_add_tips").show();if(b.status)$(".c_add_tips").html("\u9a8c\u8bc1\u7801\u53d1\u9001\u81f3\uff1a\x3cspan\x3e"+b.mobile+"\x3c/span\x3e\u8bf7\u67e5\u6536"),time=120,t=setInterval(function(){time--;$(".c_veri_code").html(time+"\u79d2\u540e\u91cd\u65b0\u83b7\u53d6");$(".c_veri_code").css("background","#999");0>=time&&(clearInterval(t),$(".c_veri_code").html("\u91cd\u65b0\u83b7\u53d6"),$(".c_veri_code").css("background","#E21931"),validCode=!0)},1E3);else{if(b.msg&&($(".c_add_tips").html(b.msg),0!=b.time)){$(".c_add_tips").delay(3E3).hide(0);time=b.time;t=setInterval(function(){time--;$(".c_veri_code").html(time+"\u79d2\u540e\u91cd\u65b0\u83b7\u53d6");$(".c_veri_code").css("background","#999");0>=time&&(clearInterval(t),$(".c_veri_code").html("\u91cd\u65b0\u83b7\u53d6"),$(".c_veri_code").css("background","#E21931"),validCode=!0)},1E3);return}$(".c_veri_code").html("\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801")}}function saveAddress(b){var a=$(".c_test").val();if(validCode)$(".c_test").siblings(".c_error").html("\u8bf7\u83b7\u53d6\u8ba4\u8bc1\u624b\u673a\u9a8c\u8bc1\u7801"),$(".c_test").siblings(".c_error").show().delay(3E3).hide(0);else if(""==a)$(".c_test").siblings(".c_error").html("\u8bf7\u8f93\u5165\u8ba4\u8bc1\u624b\u673a\u9a8c\u8bc1\u7801"),$(".c_test").siblings(".c_error").show().delay(3E3).hide(0);else if(checkData()){$(".c_save").css("background","#999");$(".c_save").css("border","1px solid #999");$(".c_save").attr("onclick","");var d=$("#isdefault").is(":checked")?1:0;"add"==type?ajaxMemberAddressAdd(name,province,city,area,street,mobile,a,zfbAccount,zfbName,saveAddressCallback,d):ajaxMemberAddressUpdate(name,province,city,area,street,mobile,a,b,zfbAccount,zfbName,saveAddressCallback,d)}}function saveAddressCallback(b){b.status?(clean(),location.reload()):($(".c_save").attr("onclick","saveAddress()"),$(".c_save").css("background","#E21931"),$(".c_save").css("border","1px solid #E21931"),layer.alert(b.msg))}function editAddress(b){$(".c_exchange_bg").show();$(".c_address_in").show();b=addressList[b];type="update";$(".c_khname").val(b.consignee);$(".c_details_address").val(b.street);$(".c_details_contact").val(b.mobile);$("#zfbAccount").val(b.zfbAccount);$("#zfbName").val(b.zfbName);$(".c_save").attr("onclick","saveAddress("+b.id+");");1==b.isdefault?$("#isdefaultDiv").hide():($("#isdefaultDiv").show(),$("#isdefault").removeAttr("checked"));for(var a=0;a<$("#province option").length;a++)if($("#province").get(0).options[a].text==b.province){$("#province").get(0).options[a].selected=!0;break}$("#province").change();for(a=0;a<$("#city option").length;a++)if($("#city").get(0).options[a].text==b.city){$("#city").get(0).options[a].selected=!0;break}$("#city").change();for(a=0;a<$("#area option").length;a++)if($("#area").get(0).options[a].text==b.area){$("#area").get(0).options[a].selected=!0;break}b=""+($("#province option:selected").text()+"  ");b+=$("#city option:selected").text()+"  ";b+=$("#area option:selected").text();$("#addStr").html(b);$("#addStr").show();$("#addStr").parents(".c_form_con").addClass("c_newform_con")}function deleteAddress(b){layer.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u5730\u5740\u5417\uff1f",function(a){layer.close(a);ajaxMemberAddressDelete(b,deleteAddressCallback)})}function deleteAddressCallback(b){clean();location.reload()}function setDefault(b){ajaxMemberAddressSetDefault(b)}function checkData(){var b=/[<>'"\/\(\)=]+/;name=$(".c_khname").val();province=$("#province option:selected").text();city=$("#city option:selected").text();area=$("#area option:selected").text();street=$(".c_details_address").val();mobile=$(".c_details_contact").val();zfbAccount=$("#zfbAccount").val();zfbName=$("#zfbName").val();if(""==name)return $(".c_khname").siblings(".c_error").html("\u8bf7\u8f93\u5165\u771f\u5b9e\u59d3\u540d\uff01"),$(".c_khname").siblings(".c_error").show().delay(3E3).hide(0),!1;if(b.test(name))return $(".c_khname").siblings(".c_error").html("\u8f93\u5165\u4e0d\u5408\u6cd5\uff01"),$(".c_khname").siblings(".c_error").show().delay(3E3).hide(0),!1;if("-1"==$("#province").val())return $("#provinceDiv").siblings(".c_error").show().delay(3E3).hide(0),!1;if("-1"==$("#city").val())return $("#cityDiv").siblings(".c_error").show().delay(3E3).hide(0),!1;if("-1"==$("#area").val())return $("#areaDiv").siblings(".c_error").show().delay(3E3).hide(0),!1;if(""==street)return $(".c_details_address").siblings(".c_error").html("\u8bf7\u8f93\u5165\u6b63\u786e\u6536\u8d27\u4eba\u5730\u5740\uff01"),$(".c_details_address").siblings(".c_error").show().delay(3E3).hide(0),!1;if(b.test(street))return $(".c_details_address").siblings(".c_error").html("\u8f93\u5165\u4e0d\u5408\u6cd5\uff01"),$(".c_details_address").siblings(".c_error").show().delay(3E3).hide(0),!1;if(""==mobile)return $("#errorMobileMsg").html("\u8bf7\u8f93\u5165\u6536\u8d27\u4eba\u624b\u673a\u53f7"),$(".c_details_contact").siblings("#errorMobileMsg").show().delay(3E3).hide(0),!1;if(/^0?1[3-8][0-9]\d{8}$/.test(mobile))return b.test(zfbAccount)&&""!=zfbAccount?($("#zfbAccountP").show().delay(3E3).hide(0),!1):b.test(zfbName)&&""!=zfbName?($("#zfbNameP").html("\u8f93\u5165\u4e0d\u5408\u6cd5").show().delay(3E3).hide(0),!1):""==zfbName&&""!=zfbAccount?($("#zfbNameP").html("\u771f\u5b9e\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a").show().delay(3E3).hide(0),!1):!0;$("#errorMobileMsg").html("\u6536\u8d27\u4eba\u624b\u673a\u53f7\u683c\u5f0f\u9519\u8bef");$(".c_details_contact").siblings("#errorMobileMsg").show().delay(3E3).hide(0);return!1}function clean(){$(".c_khname").val("");$(".c_details_address").val("");$(".c_details_contact").val("");$(".c_test").val("");$("#isdefault").removeAttr("checked");cleanAddressSelect()}function encryptPhone(b){return b.substring(0,3)+"****"+b.substring(7)}function divClick(b){$(b).find("#province").trigger("change")};