var ip_add="",times=0,orderTooken="",failure=[],order=[],row=0,rechargeToken,banUseRedGid=[24,80],ifCanUseRed=!0,ifRechange=!0,ifHasCard=!1,redAllList;$(function(){$(window).resize(function(){$(".w_pay_window_bg").css({height:$("body").height()+"px"});$(".c_pay_bj").css({height:$("body").height()+"px"});$(".w_pay_window").css({left:($(window).width()-480)/2+"px",top:($(window).height()-260)/2+"px"})});$(".c_account_btn").hide();var a=money+Math.floor(brokerageUsable+scoreUsable)+Math.floor(rebateUsable);0==a?$("#userMoney").html("0"):$("#userMoney").html(moneyIntFormat(a));0==cardUsable?$("#cardMoney").html("0"):$("#cardMoney").html(moneyIntFormat(cardUsable));ajaxGetCartToken(getCartToken);a={cart:JSON.stringify(eval(localStorage.getItem("cart")))};ajaxCartOrderList(a,bindData);$(".c_qq_close").click(function(){$(".c_recharge_remind").hide();$(".w_pay_window").hide();$(".w_pay_window_bg").hide();$(".c_pay_bj").hide()});$(".c_tel_next").click(function(){$(".c_update_tel").hide();$(".c_remind_bj").hide()});$.getScript("http://pv.sohu.com/cityjson?ie\x3dutf-8",function(){ip_add=returnCitySN.cname+" IP:"+returnCitySN.cip});redAndMoneySynchronous()});function setCardMoney(){"0"!=$("#userMoney").html()&&$("#money").prop("checked",!0);"on"!=$("#red").val()&&$("#red").prop("checked",!0);ifCanUseRed?$("#redDiv").show():$("#redDiv").hide();$("input[name\x3d'checkCart']").click(function(){for(var a=$("input[name\x3d'checkCart']"),c=0,e=0;e<a.length;e++)a[e].checked&&c++;c==a.length?$("#SelectAll").prop("checked",!0):$("#SelectAll").removeAttr("checked")})}function getCartToken(a){orderTooken=a.orderTooken}function actionClose(){$(".c_qq_close").trigger("click")}function bindData(a){var c=jaaulde.utils.cookies.get("orderUrl"),e=a.speedCid;banUseRedGid=a.virtualBid;var b="";if(null!=a.cartList&&0<a.cartList.length){row=a.cartList.length;for(i=0;i<a.cartList.length;i++){$("#null").hide();$("#data").show();var d="javascript:gotoGoods("+a.cartList[i].goodsOnline.gid+","+a.cartList[i].goodsOnline.periodCurrent+")",f=a.cartList[i].goodsOnline.goodsPrice/a.cartList[i].goodsOnline.priceArea,h=f-a.cartList[i].goodsOnline.selledTime;-1<(","+banUseRedGid+",").indexOf(","+a.cartList[i].goodsOnline.bid+",")&&(ifCanUseRed=!1,ifHasCard=!0);1<a.cartList[i].buyPeriod&&(ifCanUseRed=!1);b+='\x3ctr id\x3d"tr_'+i+'"\x3e\x3ctd class\x3d"checkbox"\x3e\x3cinput name\x3d"checkCart" id\x3d"check_'+i+'" value\x3d"'+a.cartList[i].gid+'" class\x3d"check-one check" type\x3d"checkbox" checked onclick\x3d"actionSetTotal(-1)"/\x3e\x3c/td\x3e';b+='\x3ctd class\x3d"goods"\x3e\x3ca href\x3d"'+d+'"\x3e\x3cimg src\x3d"'+imageGoodsPath+a.cartList[i].goodsOnline.showImages.split(",")[0]+'" alt\x3d""/\x3e\x3c/a\x3e';b+="\x3cspan\x3e";if(e&&e==a.cartList[i].goodsOnline.cid)b+='\x3cem style\x3d"background-color:#ff2300;padding: 3px 5px;color: #fff;font-size: 12px;"\x3e\u6781\u901f\u4e13\u533a\x3c/em\x3e';else if(0<a.cartList[i].goodsOnline.maxBuy)b+='\x3cem class\x3d"w_add_limit" style\x3d"background:#9ad000;padding: 3px 5px;color: #fff;font-size: 12px;"\x3e\u9650\u8d2d\u4e13\u533a\x3c/em\x3e';else if(2<a.cartList[i].goodsOnline.priceArea){var g="";10==a.cartList[i].goodsOnline.priceArea?g="background:#d647b1;padding: 3px 5px;color: #fff;font-size: 12px;":100==a.cartList[i].goodsOnline.priceArea&&(g="background:#ff9c00;padding: 3px 5px;color: #fff;font-size: 12px;");b+='\x3cem style\x3d"'+g+'"\x3e'+actionNoToChinese(a.cartList[i].goodsOnline.priceArea)+"\u5143\u4e13\u533a\x3c/em\x3e"}b+='\x3ca href\x3d"'+d+'" id\x3d"title_'+i+'"\x3e'+a.cartList[i].goodsOnline.title+'\x3c/a\x3e\x3c/span\x3e\x3cb class\x3d"c_goods_price"\x3e';b+="\u603b\u9700\x3ci\x3e"+f+"\x3c/i\x3e\u4eba\u6b21\u53c2\u4e0e\uff0c\u8fd8\u5269\x3ci\x3e"+h+"\x3c/i\x3e\u4eba\u6b21\x3c/b\x3e\x3c/td\x3e";b+='\x3ctd class\x3d"price w_price" id\x3d"surplus_'+i+'"\x3e'+h+"\x3c/td\x3e";0>a.cartList[i].buyTimes&&(a.cartList[i].buyTimes=0);0<a.cartList[i].goodsOnline.maxBuy?(b+='\x3ctd class\x3d"w_one"\x3e\x3cdiv class\x3d"w_one_new"\x3e',b+='\x3cspan class\x3d"w_pre w_pre_one"\x3e-\x3c/span\x3e',b+='\x3cinput width\x3d"60px" class\x3d"count-input1 count-input-other" type\x3d"text" id\x3d"buyTimes_'+i+'" value\x3d"'+a.cartList[i].buyTimes+'" disabled   /\x3e',b+='\x3cspan class\x3d"w_next w_next_one""\x3e+\x3c/span\x3e',b=0==a.cartList[i].buyTimes?b+"\x3cp\x3e\u5df2\u8fbe\u9650\u8d2d\u4e0a\u9650\x3c/p\x3e":b+("\x3cp\x3e\u9650\u8d2d"+a.cartList[i].buyTimes+"\u4eba\u6b21\x3c/p\x3e")):(b+='\x3ctd class\x3d"count"\x3e\x3cdiv class\x3d"w_one_new"\x3e',b+='\x3cspan class\x3d"reduce" onclick\x3d"actionMinusTimes('+i+')" onmousedown\x3d"actionStare1('+i+')" onmouseout\x3d"actionEnd1('+i+')"  onmouseup\x3d"actionEnd1('+i+') "\x3e-\x3c/span\x3e',b+='\x3cinput width\x3d"70px" onmouseover\x3d"this.focus();this.select();" class\x3d"count-input" type\x3d"text" maxlength\x3d"5" id\x3d"buyTimes_'+i+'" value\x3d"'+a.cartList[i].buyTimes,b+='"  onafterpaste\x3d"actionUpdate('+i+');" onkeyup\x3d"actionUpdate('+i+')"/\x3e',b+='\x3cspan class\x3d"add" onclick\x3d"actionAddTimes('+i+')" onmouseout\x3d"actionEnd2('+i+')"  onmousedown\x3d"actionStare2('+i+')" onmouseup\x3d"actionEnd2('+i+')"\x3e+\x3c/span\x3e');b+='\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"w_one"\x3e\x3cdiv class\x3d"w_one_new"\x3e';0==a.cartList[i].goodsOnline.multiFlag?(b+='\x3cspan class\x3d"w_pre w_pre_one" \x3e-\x3c/span\x3e',b+='\x3cinput  class\x3d"count-input1 count-input-other" type\x3d"text" id\x3d"buyPeriod_'+i+'" value\x3d"'+a.cartList[i].buyPeriod,b+='"  disabled /\x3e',b+='\x3cspan class\x3d"w_next w_next_one" \x3e+\x3c/span\x3e'):(b+='\x3cspan class\x3d"w_pre " onclick\x3d"actionMinusPeriod('+i+')" onmousedown\x3d"actionStare3('+i+')" onmouseout\x3d"actionEnd3('+i+')"  onmouseup\x3d"actionEnd3('+i+')" onclick\x3d"actionMinusPeriod('+i+')"\x3e-\x3c/span\x3e',b+='\x3cinput  class\x3d"count-input1 " type\x3d"text" id\x3d"buyPeriod_'+i+'" value\x3d"'+a.cartList[i].buyPeriod,b+='" onafterpaste\x3d"actionUpdate('+i+');" onkeyup\x3d"actionUpdate('+i+')"/\x3e',b+='\x3cspan class\x3d"w_next" onclick\x3d"actionAddPeriod('+i+')" onmousedown\x3d"actionStare4('+i+')" onmouseout\x3d"actionEnd4('+i+')"  onmouseup\x3d"actionEnd4('+i+')" \x3e+\x3c/span\x3e');b+='\x3cp id\x3d"td_period_'+i+'"\x3e\x3c/p\x3e\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"subtotal" id\x3d"price_'+i+'"\x3e'+a.cartList[i].buyTimes*a.cartList[i].buyPeriod*a.cartList[i].goodsOnline.priceArea+"\x3c/td\x3e";b+='\x3cinput  type\x3d"hidden" id\x3d"area_'+i+'" value\x3d"'+a.cartList[i].goodsOnline.priceArea+'"/\x3e';b+='\x3cinput  type\x3d"hidden" id\x3d"gid_'+i+'" value\x3d"'+a.cartList[i].gid+'"/\x3e';b+='\x3cinput  type\x3d"hidden" id\x3d"cid_'+i+'" value\x3d"'+a.cartList[i].goodsOnline.cid+'"/\x3e';b+='\x3cinput  type\x3d"hidden" id\x3d"id_'+i+'" value\x3d"'+a.cartList[i].id+'"/\x3e\x3c/td\x3e';b+='\x3ctd class\x3d"operation"\x3e\x3cspan class\x3d"delete" onclick\x3d"actionDel('+i+')"\x3e\u5220\u9664\x3c/span\x3e\x3c/td\x3e\x3c/tr\x3e'}$("#listTable").html(b);$("#SelectAll").prop("checked",!0);$("#data").show()}else $("#cartListLength").html(0),$("#null").show(),$("#nullImg").attr("src","../static/img/front/cloud_global/shop_bag.png"),$("#data").hide();0<a.redList.length&&(redAllList=a.redList);actionSetTotal();setCardMoney();setRechargeMoney();$(window).resize();null!=c&&""!=c&&c==$("#mid").val()&&(ajaxGetCartToken(getCartToken),jaaulde.utils.cookies.set("orderUrl","",{path:"/"}),ifRechange=!1,actionSettlement())}function actionSettlement(){if(0!=$("#priceTotal").html())if($("#agreement").attr("checked")){var a=0,c=encodeURI("/pay/commitOrder.do");getOrder();if(0!=order.length){var e={data:JSON.stringify(order),total:$("#priceTotal").html(),client:"PC",tk:orderTooken,ip:ip_add};if("checked"==$("#red").attr("checked")&&ifCanUseRed){var b=$("#red").val();"on"!=b&&(a+=parseInt($("#redBalance_"+b).val()),e.rid=b)}$("#money").is(":checked")&&(a+=parseInt($("#userMoney").html().replace(/,/g,"")),e.cflag=1);$("#card").is(":checked")&&(a+=parseInt($("#cardMoney").html().replace(/,/g,"")),e.pcflag=1);1E5<=$("#priceTotal").html()?alerts("\u63d0\u793a\uff1a","\u91d1\u989d\u6700\u592710\u4e07","350","150"):a<$("#priceTotal").html()?(jaaulde.utils.cookies.set("orderUrl",$("#mid").val()),ifRechange?doRecharge():(jaaulde.utils.cookies.set("orderUrl","",{path:"/"}),ifRechange=!0)):($(".c_pay_bj").show(),$(".c_pay_wait").show(),ajaxSettlement(c,e,settlementReturn))}}else alerts("\u63d0\u793a\uff1a","\u8bf7\u5148\u9605\u8bfb\u670d\u52a1\u534f\u8bae\uff01","350","150")}function gotoRechangeList(){jaaulde.utils.cookies.set("orderUrl","",{path:"/"});window.location.href="/member_new/money.do"}function settlementReturn(a){jaaulde.utils.cookies.set("alist",JSON.stringify(a.alist),{path:"/"});var c=encodeURIComponent(a.msg);encodeURIComponent(a.err);window.location.href="/cart/result.do?status\x3d"+a.status+"\x26msg\x3d"+c+"\x26code\x3d"+a.code+"\x26total\x3d"+$("#priceTotal").html()}function actionAddAddress(){clesn();$("#id").val("");$(".c_address_bj").show();$(".c_address_window").show()}function actionNoToChinese(a){var c="\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".split(""),e=" \u5341 \u767e \u5343 \u4e07 \u4ebf \u70b9 ".split(" ");a=(""+a).replace(/(^0*)/g,"").split(".");for(var b=0,d="",f=a[0].length-1;0<=f;f--){switch(b){case 0:d=e[7]+d;break;case 4:(new RegExp("0{4}\\d{"+(a[0].length-f-1)+"}$")).test(a[0])||(d=e[4]+d);break;case 8:d=e[5]+d,e[7]=e[5],b=0}2==b%4&&0!=a[0].charAt(f+2)&&0==a[0].charAt(f+1)&&(d=c[0]+d);0!=a[0].charAt(f)&&(d=c[a[0].charAt(f)]+e[b%4]+d);b++}if(1<a.length)for(d+=e[6],f=0;f<a[1].length;f++)d+=c[a[1].charAt(f)];"\u4e00"==d.substr(0,1)&&2==d.length&&(d=d.substr(1,1));return d}function setRed(){if(redAllList){$(".selectBox").html('\x3cdiv class\x3d"select_showbox selectDiv" style\x3d"cursor: pointer;"\x3e\u6682\u65e0\u53ef\u7528\u7ea2\u5305\x3c/div\x3e');var a='\x3cul class\x3d"select_option selectOption" style\x3d"display: none;"\x3e',c=0;for(i=0;i<redAllList.length;i++)redAllList[i].limit_money<=$("#priceTotal").html()&&(0==c&&($(".selectDiv").html(redAllList[i].rname),$("#red").val(redAllList[i].id)),c++,a+='\x3cli style\x3d"cursor: pointer;" value\x3d"'+redAllList[i].id+'" \x3e'+redAllList[i].rname+"\x3c/li\x3e",a+='\x3cinput type\x3d"hidden" value\x3d"'+redAllList[i].red_balance+'" id\x3d"redBalance_'+redAllList[i].id+'" /\x3e');0<c&&($(".selectBox").append(a),$(".selectDiv").click(function(){$(".selectOption").show()}),$(".selectOption li").click(function(){$("#red").val($(this).val());$(".selectDiv").html($(this).html());$(".selectOption").hide();setRechargeMoney()}));12>c&&$(".selectOption").attr("style","height:"+24*c+"px;")}}function redAndMoneySynchronous(){$("#red").click(function(){$("#card").is(":checked")&&($("#card").removeAttr("checked"),$("#cardTips").show(300).delay(1E3).hide(0));setRechargeMoney()});$("#card").click(function(){$("#red").is(":checked")&&($("#red").removeAttr("checked"),$("#redTips").show(300).delay(1E3).hide(100));setRechargeMoney()});$("#money").click(function(){setRechargeMoney()})}function baiduTag_order(a,c){_hmt.push(["_trackRTEvent",{data:{ecom_order:{order_id:"",order_first:"",order_sum:c,prod:a}}}])}function baiduTag_paySucess(a,c){_hmt.push(["_trackRTEvent",{data:{ecom_pay_online:{order_id:"",order_first:"",order_sum:c,prod:a}}}])};