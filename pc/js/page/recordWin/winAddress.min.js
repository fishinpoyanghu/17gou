var validCode=!0,name,province,city,area,street,mobile,addressList,type,zfbAccount,zfbName;$(function(){tableId="#datalist";addAddress();$(window).resize(function(){$("body").height();var a=$(window).width(),b=$(window).height();$(".c_address_in").css({left:(a-784)/2+"px",top:(b-492)/2+"px",height:"570px"})});$(".c_exchange_bg").css({height:"1586px"});$(window).resize()});function sendMsgCallback(a){validCode=!1;$(".c_add_tips").show();if(a.status)$(".c_add_tips").html("\u9a8c\u8bc1\u7801\u53d1\u9001\u81f3\uff1a\x3cspan\x3e"+a.mobile+"\x3c/span\x3e\u8bf7\u67e5\u6536"),time=120,t=setInterval(function(){time--;$(".c_veri_code").html(time+"\u79d2\u540e\u91cd\u65b0\u83b7\u53d6");$(".c_veri_code").css("background","#999");0>=time&&(clearInterval(t),$(".c_veri_code").html("\u91cd\u65b0\u83b7\u53d6"),$(".c_veri_code").css("background","#E21931"),validCode=!0)},1E3);else{if(a.msg&&($(".c_add_tips").html(a.msg),0!=a.time)){$(".c_add_tips").delay(3E3).hide(0);time=a.time;t=setInterval(function(){time--;$(".c_veri_code").html(time+"\u79d2\u540e\u91cd\u65b0\u83b7\u53d6");$(".c_veri_code").css("background","#999");0>=time&&(clearInterval(t),$(".c_veri_code").html("\u91cd\u65b0\u83b7\u53d6"),$(".c_veri_code").css("background","#E21931"),validCode=!0)},1E3);return}$(".c_veri_code").html("\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801")}}function saveAddress(a){var b=$(".c_test").val();if(validCode)$(".c_test").siblings(".c_error").html("\u8bf7\u83b7\u53d6\u8ba4\u8bc1\u624b\u673a\u9a8c\u8bc1\u7801"),$(".c_test").siblings(".c_error").show().delay(3E3).hide(0);else if(""==b)$(".c_test").siblings(".c_error").html("\u8bf7\u8f93\u5165\u8ba4\u8bc1\u624b\u673a\u9a8c\u8bc1\u7801"),$(".c_test").siblings(".c_error").show().delay(3E3).hide(0);else if(checkData()){$(".c_save").css("background","#999");$(".c_save").css("border","1px solid #999");$(".c_save").attr("onclick","");var c=$("#isdefault").is(":checked")?1:0;"add"==type?ajaxMemberAddressAdd(name,province,city,area,street,mobile,b,zfbAccount,zfbName,saveAddressCallback,c):ajaxMemberAddressUpdate(name,province,city,area,street,mobile,b,a,zfbAccount,zfbName,saveAddressCallback,c)}}function saveAddressCallback(a){a.status?(ajaxGetAddress(setAddressList),$(".c_address_in").hide()):($(".c_save").attr("onclick","saveAddress()"),$(".c_save").css("background","#E21931"),$(".c_save").css("border","1px solid #E21931"),layer.alert(a.msg))}function editAddress(a){$(".c_address_in").show();$(".c_exchange_bg").show();a=addressList[a];type="update";$(".c_khname").val(a.consignee);$(".c_details_address").val(a.street);$(".c_details_contact").val(a.mobile);$("#zfbAccount").val(a.zfbAccount);$("#zfbName").val(a.zfbName);$(".c_save").attr("onclick","saveAddress("+a.id+");");for(var b=0;b<$("#province option").length;b++)if($("#province").get(0).options[b].text==a.province){$("#province").get(0).options[b].selected=!0;break}1==a.isdefault?$("#isdefaultDiv").hide():($("#isdefaultDiv").show(),$("#isdefault").removeAttr("checked"));$("#province").change();for(b=0;b<$("#city option").length;b++)if($("#city").get(0).options[b].text==a.city){$("#city").get(0).options[b].selected=!0;break}$("#city").change();for(b=0;b<$("#area option").length;b++)if($("#area").get(0).options[b].text==a.area){$("#area").get(0).options[b].selected=!0;break}a=""+($("#province option:selected").text()+"  ");a+=$("#city option:selected").text()+"  ";a+=$("#area option:selected").text();$("#addStr").html(a);$("#addStr").parents(".c_form_con").addClass("c_newform_con")}function deleteAddress(a){layer.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u5730\u5740\u5417\uff1f",function(b){layer.close(b);ajaxMemberAddressDelete(a,deleteAddressCallback)})}function deleteAddressCallback(a){clean();ajaxGetAddress(setAddressList)}function setDefault(a){ajaxMemberAddressSetDefault(a,setDefaultBack)}function setDefaultBack(a){ajaxGetAddress(setAddressList)}function checkData(){var a=/[<>'"\/\(\)=]+/;name=$(".c_khname").val();province=$("#province option:selected").text();city=$("#city option:selected").text();area=$("#area option:selected").text();street=$(".c_details_address").val();mobile=$(".c_details_contact").val();zfbAccount=$("#zfbAccount").val();zfbName=$("#zfbName").val();if(""==name)return $(".c_khname").siblings(".c_error").html("\u8bf7\u8f93\u5165\u771f\u5b9e\u59d3\u540d\uff01"),$(".c_khname").siblings(".c_error").show().delay(3E3).hide(0),!1;if(a.test(name))return $(".c_khname").siblings(".c_error").html("\u8f93\u5165\u4e0d\u5408\u6cd5\uff01"),$(".c_khname").siblings(".c_error").show().delay(3E3).hide(0),!1;if("-1"==$("#province").val())return $("#provinceDiv").siblings(".c_error").show().delay(3E3).hide(0),!1;if("-1"==$("#city").val())return $("#cityDiv").siblings(".c_error").show().delay(3E3).hide(0),!1;if("-1"==$("#area").val())return $("#areaDiv").siblings(".c_error").show().delay(3E3).hide(0),!1;if(""==street)return $(".c_details_address").siblings(".c_error").html("\u8bf7\u8f93\u5165\u6b63\u786e\u6536\u8d27\u4eba\u5730\u5740\uff01"),$(".c_details_address").siblings(".c_error").show().delay(3E3).hide(0),!1;if(a.test(street))return $(".c_details_address").siblings(".c_error").html("\u8f93\u5165\u4e0d\u5408\u6cd5\uff01"),$(".c_details_address").siblings(".c_error").show().delay(3E3).hide(0),!1;if(""==mobile)return $("#errorMobileMsg").html("\u8bf7\u8f93\u5165\u6536\u8d27\u4eba\u624b\u673a\u53f7"),$(".c_details_contact").siblings("#errorMobileMsg").show().delay(3E3).hide(0),!1;if(/^0?1[3-8][0-9]\d{8}$/.test(mobile))return a.test(zfbAccount)&&""!=zfbAccount?($("#zfbAccountP").show().delay(3E3).hide(0),!1):a.test(zfbName)&&""!=zfbName?($("#zfbNameP").html("\u8f93\u5165\u4e0d\u5408\u6cd5").show().delay(3E3).hide(0),!1):""==zfbName&&""!=zfbAccount?($("#zfbNameP").html("\u771f\u5b9e\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a").show().delay(3E3).hide(0),!1):!0;$("#errorMobileMsg").html("\u6536\u8d27\u4eba\u624b\u673a\u53f7\u683c\u5f0f\u9519\u8bef");$(".c_details_contact").siblings("#errorMobileMsg").show().delay(3E3).hide(0);return!1}function clean(){$(".c_khname").val("");$(".c_details_address").val("");$(".c_details_contact").val("");$(".c_test").val("");$("#isdefault").removeAttr("checked");cleanAddressSelect()}function encryptPhone(a){return a.substring(0,3)+"****"+a.substring(7)}function divClick(a){$(a).find("#province").trigger("change")}var arrySheng=[],arryShi=[],arryXian=[],areaSelect={createSelect:function(){$("#province").empty();$("#city").empty();$("#area").empty();$("#province")[0].options.add(new Option("\u8bf7\u9009\u62e9\u7701\u4efd","-1"));$("#city")[0].options.add(new Option("\u8bf7\u9009\u62e9\u5e02","-1"));$("#area")[0].options.add(new Option("\u8bf7\u9009\u62e9\u533a\u3001\u53bf","-1"));areaSelect.bindSheng();areaSelect.showSelect()},showSelect:function(){$("#province").change(function(){areaSelect.bindShi(this.value)});$("#city").change(function(){areaSelect.bindXian(this.value)})},bindSheng:function(){$("#city").empty();$("#city")[0].options.add(new Option("\u8bf7\u9009\u62e9\u5e02","-1"));$.each(arrySheng,function(a,b){$("#province")[0].options.add(new Option(b[0],b[1]))})},bindShi:function(a){$("#city").empty();$("#city")[0].options.add(new Option("\u8bf7\u9009\u62e9\u5e02","-1"));$("#area").empty();$("#area")[0].options.add(new Option("\u8bf7\u9009\u62e9\u533a\u3001\u53bf","-1"));$.each(arryShi,function(b,c){c[2]==a&&$("#city")[0].options.add(new Option(c[0],c[1]))})},bindXian:function(a){$("#area").empty();$("#area")[0].options.add(new Option("\u8bf7\u9009\u62e9\u533a\u3001\u53bf","-1"));$.each(arryXian,function(b,c){c[2]==a&&$("#area")[0].options.add(new Option(c[0],c[1]))})}};function addAddress(){$.getJSON("/static/json/region_info.json",function(a){$.each(a.region_info,function(a,c){1==c.PARENT_ID?arrySheng.push([c.NAME,c.ID,c.PARENT_ID]):"00"==c.CODE.substring(4,6)?arryShi.push([c.NAME,c.ID,c.PARENT_ID]):1!=c.ID&&arryXian.push([c.NAME,c.ID,c.PARENT_ID])});areaSelect.createSelect()})}function cleanAddressSelect(){areaSelect.createSelect()};